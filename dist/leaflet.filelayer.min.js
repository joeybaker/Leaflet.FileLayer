!function(a,b){"object"==typeof exports?module.exports=b(require("togeojson")):"function"==typeof define&&define.amd?define(["togeojson"],b):a.L.FileLoader=b(a.L,a.toGeoJSON)}(this,function(a){"use strict";function b(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}var c=window.L,d=c.Class.extend({includes:c.Mixin.Events,options:{layerOptions:{},addToMap:!0},initialize:function(a,b){this._map=a,c.Util.setOptions(this,b),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(a){var b=a.name.split(".").pop(),d=this._parsers[b],e=new FileReader;return d?(e.onload=c.Util.bind(function(c){var e;this.fire("data:loading",{filename:a.name,format:b}),e=d.call(this,c.target.result,b),e&&this.fire("data:loaded",{layer:e,filename:a.name,format:b})},this),e.readAsText(a),void 0):(window.alert("Unsupported file type "+a.type+"("+b+")"),void 0)},_loadGeoJSON:function(a){var d;"string"==typeof a&&(a=JSON.parse(a));try{d=c.geoJson(a,this.options.layerOptions)}catch(e){return this.fire("data:error",{error:e,message:"Error parsing upload."}),void 0}return!d||b(d._layers)?(this.fire("data:error",{error:new Error("Parsed GeoJSON has no valid layers."),message:"No valid information in your upload."}),void 0):this.options.addToMap?d.addTo(this._map):d},_convertToGeoJSON:function(b,c){return"string"==typeof b&&(b=(new window.DOMParser).parseFromString(b,"text/xml")),this._loadGeoJSON(a[c](b))}});return c.Control.FileLayerLoad=c.Control.extend({statics:{title:"Load local file (GPX, KML, GeoJSON)",label:"Upload",className:"leaflet-control-filelayer",barName:"leaflet-bar",barPartName:"leaflet-bar-part"},options:{position:"topleft",fitBounds:!0,layerOptions:{}},initialize:function(a){c.Util.setOptions(this,a),this.loader=null},onAdd:function(a){return this.loader=new d(a,this.options),this.loader.on("data:loaded",function(b){this.options.fitBounds&&window.setTimeout(function(){a.fitBounds(b.layer.getBounds())},200)},this),this._initDragAndDrop(a),this._initContainer()},_initDragAndDrop:function(a){var b=this.loader,c=a._container,d={dragenter:function(){a.scrollWheelZoom.disable()},dragleave:function(){a.scrollWheelZoom.enable()},dragover:function(a){a.stopPropagation(),a.preventDefault()},drop:function(c){var d=Array.prototype.slice.apply(c.dataTransfer.files),e=25;!function f(){b.load(d.shift()),d.length>0&&setTimeout(f,e)}(),c.stopPropagation(),c.preventDefault(),a.scrollWheelZoom.enable()}};for(var e in d)c.addEventListener(e,d[e],!1)},_initContainer:function(){var a,b=this.loader,d=c.Control.FileLayerLoad.className,e=c.Control.FileLayerLoad.barName,f=c.Control.FileLayerLoad.barPartName,g=c.DomUtil.create("div",d),h=c.DomUtil.create("div",e,g),i=c.DomUtil.create("a",f,h),j=c.DomUtil.create("input","hidden",i),k=this;return j.type="file",j.accept=".gpx,.kml,.geojson",j.style.display="none",j.addEventListener("change",function(){return(this.files[0].size/1024).toFixed(4)>k.options.fileSize?(b.fire("data:error",{error:new Error("File size to big."),message:"Files need to be smaller than "+k.options.fileSize+"kb."}),void 0):(b.load(this.files[0]),this.value="",void 0)},!1),i.innerHTML=c.Control.FileLayerLoad.label,i.href="#",i.title=c.Control.FileLayerLoad.title,c.DomEvent.disableClickPropagation(i),a=function(){j.click()},c.DomEvent.on(i,"click",a),this.button=i,this.fileInput=j,this.onclick=a,g}}),c.Control.fileLayerLoad=function(a){return new c.Control.FileLayerLoad(a)},d});