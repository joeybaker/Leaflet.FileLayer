!function(a,b){"object"==typeof exports?module.exports=b(require("togeojson")):"function"==typeof define&&define.amd?define(["togeojson"],b):a.L.FileLoader=b(a.L,a.toGeoJSON)}(this,function(a){"use strict";var b=window.L,c=b.Class.extend({includes:b.Mixin.Events,options:{layerOptions:{},addToMap:!0},initialize:function(a,c){this._map=a,b.Util.setOptions(this,c),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(a){var c=a.name.split(".").pop(),d=this._parsers[c],e=new FileReader;return d?(e.onload=b.Util.bind(function(b){var e;this.fire("data:loading",{filename:a.name,format:c}),e=d.call(this,b.target.result,c),this.fire("data:loaded",{layer:e,filename:a.name,format:c})},this),e.readAsText(a),void 0):(window.alert("Unsupported file type "+a.type+"("+c+")"),void 0)},_loadGeoJSON:function(a){var c=b.geoJson(a,this.options.layerOptions);return"string"==typeof a&&(a=JSON.parse(a)),this.options.addToMap?c.addTo(this._map):c},_convertToGeoJSON:function(b,c){return"string"==typeof b&&(b=(new window.DOMParser).parseFromString(b,"text/xml")),this._loadGeoJSON(a[c](b))}});return b.Control.FileLayerLoad=b.Control.extend({statics:{title:"Load local file (GPX, KML, GeoJSON)",label:"Upload",className:"leaflet-control-filelayer",barName:"leaflet-bar",barPartName:"leaflet-bar-part"},options:{position:"topleft",fitBounds:!0,layerOptions:{}},initialize:function(a){b.Util.setOptions(this,a),this.loader=null},onAdd:function(a){return this.loader=new c(a,this.options),this.loader.on("data:loaded",function(b){this.options.fitBounds&&window.setTimeout(function(){a.fitBounds(b.layer.getBounds())},200)},this),this._initDragAndDrop(a),this._initContainer()},_initDragAndDrop:function(a){var b=this.loader,c=a._container,d={dragenter:function(){a.scrollWheelZoom.disable()},dragleave:function(){a.scrollWheelZoom.enable()},dragover:function(a){a.stopPropagation(),a.preventDefault()},drop:function(c){var d=Array.prototype.slice.apply(c.dataTransfer.files),e=25;!function f(){b.load(d.shift()),d.length>0&&setTimeout(f,e)}(),c.stopPropagation(),c.preventDefault(),a.scrollWheelZoom.enable()}};for(var e in d)c.addEventListener(e,d[e],!1)},_initContainer:function(){var a,c=this.loader,d=b.Control.FileLayerLoad.className,e=b.Control.FileLayerLoad.barName,f=b.Control.FileLayerLoad.barPartName,g=b.DomUtil.create("div",d),h=b.DomUtil.create("div",e,g),i=b.DomUtil.create("a",d+" "+f,h),j=b.DomUtil.create("input","hidden",i);return j.type="file",j.accept=".gpx,.kml,.geojson",j.style.display="none",j.addEventListener("change",function(){c.load(this.files[0]),this.value=""},!1),i.innerHTML=b.Control.FileLayerLoad.label,i.href="#",i.title=b.Control.FileLayerLoad.title,b.DomEvent.disableClickPropagation(i),a=function(){j.click()},b.DomEvent.on(i,"click",a),this.button=i,this.fileInput=j,this.onclick=a,g}}),b.Control.fileLayerLoad=function(a){return new b.Control.FileLayerLoad(a)},c});