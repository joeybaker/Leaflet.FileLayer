!function(a,b){"object"==typeof exports?module.exports=b(require("togeojson")):"function"==typeof define&&define.amd?define(["togeojson"],b):a.L.FileLoader=b(a.L,a.toGeoJSON)}(this,function(){"use strict";var a=window.L,b=a.Class.extend({includes:a.Mixin.Events,options:{layerOptions:{},addToMap:!0},initialize:function(b,c){this._map=b,a.Util.setOptions(this,c),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(b){var c=b.name.split(".").pop(),d=this._parsers[c];if(!d)return window.alert("Unsupported file type "+b.type+"("+c+")"),void 0;var e=new FileReader;e.onload=a.Util.bind(function(a){this.fire("data:loading",{filename:b.name,format:c});var e=d.call(this,a.target.result,c);this.fire("data:loaded",{layer:e,filename:b.name,format:c})},this),e.readAsText(b)},_loadGeoJSON:function(b){var c=a.geoJson(b,this.options.layerOptions);return"string"==typeof b&&(b=JSON.parse(b)),this.options.addToMap?c.addTo(this._map):c},_convertToGeoJSON:function(a,b){"string"==typeof a&&(a=(new window.DOMParser).parseFromString(a,"text/xml"));var c=toGeoJSON[b](a);return this._loadGeoJSON(c)}});return a.Control.FileLayerLoad=a.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{}},initialize:function(b){a.Util.setOptions(this,b),this.loader=null},onAdd:function(a){return this.loader=new b(a,{layerOptions:this.options.layerOptions}),this.loader.on("data:loaded",function(b){this.options.fitBounds&&window.setTimeout(function(){a.fitBounds(b.layer.getBounds()).zoomOut()},500)},this),this._initDragAndDrop(a),this._initContainer()},_initDragAndDrop:function(a){var b=this.loader,c=a._container,d={dragenter:function(){a.scrollWheelZoom.disable()},dragleave:function(){a.scrollWheelZoom.enable()},dragover:function(a){a.stopPropagation(),a.preventDefault()},drop:function(c){var d=Array.prototype.slice.apply(c.dataTransfer.files),e=25;!function f(){b.load(d.shift()),d.length>0&&setTimeout(f,e)}(),c.stopPropagation(),c.preventDefault(),a.scrollWheelZoom.enable()}};for(var e in d)c.addEventListener(e,d[e],!1)},_initContainer:function(){var b=this.loader,c="leaflet-control-filelayer leaflet-control-zoom",d="leaflet-bar",e=d+"-part",f=a.DomUtil.create("div",c+" "+d),g=a.DomUtil.create("input","hidden",f),h=a.DomUtil.create("a",c+"-in "+e,f),i=a.DomEvent.stopPropagation;return g.type="file",g.accept=".gpx,.kml,.geojson",g.style.display="none",g.addEventListener("change",function(){b.load(this.files[0])},!1),h.innerHTML=a.Control.FileLayerLoad.LABEL,h.href="#",h.title=a.Control.FileLayerLoad.TITLE,a.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",a.DomEvent.preventDefault).on(h,"click",function(a){g.click(),a.preventDefault()}),f}}),a.Control.fileLayerLoad=function(b){return new a.Control.FileLayerLoad(b)},b});