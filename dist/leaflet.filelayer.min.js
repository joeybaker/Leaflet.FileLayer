!function(a,b){"object"==typeof exports?module.exports=b(require("leaflet"),require("togeojson")):"function"==typeof define&&define.amd?define(["leaflet","togeojson"],b):a.L.FileLoader=b(a.L,a.togeojson)}(this,function(a){var b=a?a:window.L,c=b.Class.extend({includes:b.Mixin.Events,options:{layerOptions:{}},initialize:function(a,c){this._map=a,b.Util.setOptions(this,c),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(a){var c=a.name.split(".").pop(),d=this._parsers[c];if(!d)return window.alert("Unsupported file type "+a.type+"("+c+")"),void 0;var e=new FileReader;e.onload=b.Util.bind(function(b){this.fire("data:loading",{filename:a.name,format:c});var e=d.call(this,b.target.result,c);this.fire("data:loaded",{layer:e,filename:a.name,format:c})},this),e.readAsText(a)},_loadGeoJSON:function(a){return"string"==typeof a&&(a=JSON.parse(a)),b.geoJson(a,this.options.layerOptions).addTo(this._map)},_convertToGeoJSON:function(a,b){"string"==typeof a&&(a=(new window.DOMParser).parseFromString(a,"text/xml"));var c=toGeoJSON[b](a);return this._loadGeoJSON(c)}});return b.Control.FileLayerLoad=b.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{}},initialize:function(a){b.Util.setOptions(this,a),this.loader=null},onAdd:function(a){return this.loader=new c(a,{layerOptions:this.options.layerOptions}),this.loader.on("data:loaded",function(b){this.options.fitBounds&&window.setTimeout(function(){a.fitBounds(b.layer.getBounds()).zoomOut()},500)},this),this._initDragAndDrop(a),this._initContainer()},_initDragAndDrop:function(a){var b=this.loader,c=a._container,d={dragenter:function(){a.scrollWheelZoom.disable()},dragleave:function(){a.scrollWheelZoom.enable()},dragover:function(a){a.stopPropagation(),a.preventDefault()},drop:function(c){c.stopPropagation(),c.preventDefault();{var d=Array.prototype.slice.apply(c.dataTransfer.files);d.length}setTimeout(function(){b.load(d.shift()),d.length>0&&setTimeout(arguments.callee,25)},25),a.scrollWheelZoom.enable()}};for(var e in d)c.addEventListener(e,d[e],!1)},_initContainer:function(){var a=b.DomUtil.create("input","hidden",g);a.type="file",a.accept=".gpx,.kml,.geojson",a.style.display="none";var c=this.loader;a.addEventListener("change",function(){c.load(this.files[0])},!1);var d="leaflet-control-filelayer leaflet-control-zoom",e="leaflet-bar",f=e+"-part",g=b.DomUtil.create("div",d+" "+e),h=b.DomUtil.create("a",d+"-in "+f,g);h.innerHTML=b.Control.FileLayerLoad.LABEL,h.href="#",h.title=b.Control.FileLayerLoad.TITLE;var i=b.DomEvent.stopPropagation;return b.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",b.DomEvent.preventDefault).on(h,"click",function(b){a.click(),b.preventDefault()}),g}}),b.Control.fileLayerLoad=function(a){return new b.Control.FileLayerLoad(a)},c});