!function(a,b){"object"==typeof exports?module.exports=b(require("togeojson")):"function"==typeof define&&define.amd?define(["togeojson"],b):a.L.FileLoader=b(a.L,a.toGeoJSON)}(this,function(a){"use strict";var b=window.L,c=b.Class.extend({includes:b.Mixin.Events,options:{layerOptions:{},addToMap:!0},initialize:function(a,c){this._map=a,b.Util.setOptions(this,c),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(a){var c=a.name.split(".").pop(),d=this._parsers[c];if(!d)return window.alert("Unsupported file type "+a.type+"("+c+")"),void 0;var e=new FileReader;e.onload=b.Util.bind(function(b){this.fire("data:loading",{filename:a.name,format:c});var e=d.call(this,b.target.result,c);this.fire("data:loaded",{layer:e,filename:a.name,format:c})},this),e.readAsText(a)},_loadGeoJSON:function(a){var c=b.geoJson(a,this.options.layerOptions);return"string"==typeof a&&(a=JSON.parse(a)),this.options.addToMap?c.addTo(this._map):c},_convertToGeoJSON:function(b,c){"string"==typeof b&&(b=(new window.DOMParser).parseFromString(b,"text/xml"));var d=a[c](b);return this._loadGeoJSON(d)}});return b.Control.FileLayerLoad=b.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{}},initialize:function(a){b.Util.setOptions(this,a),this.loader=null},onAdd:function(a){return this.loader=new c(a,this.options),this.loader.on("data:loaded",function(b){this.options.fitBounds&&window.setTimeout(function(){a.fitBounds(b.layer.getBounds()).zoomOut()},500)},this),this._initDragAndDrop(a),this._initContainer()},_initDragAndDrop:function(a){var b=this.loader,c=a._container,d={dragenter:function(){a.scrollWheelZoom.disable()},dragleave:function(){a.scrollWheelZoom.enable()},dragover:function(a){a.stopPropagation(),a.preventDefault()},drop:function(c){var d=Array.prototype.slice.apply(c.dataTransfer.files),e=25;!function f(){b.load(d.shift()),d.length>0&&setTimeout(f,e)}(),c.stopPropagation(),c.preventDefault(),a.scrollWheelZoom.enable()}};for(var e in d)c.addEventListener(e,d[e],!1)},_initContainer:function(){var a=this.loader,c="leaflet-control-filelayer leaflet-control-zoom",d="leaflet-bar",e=d+"-part",f=b.DomUtil.create("div",c+" "+d),g=b.DomUtil.create("input","hidden",f),h=b.DomUtil.create("a",c+"-in "+e,f),i=b.DomEvent.stopPropagation;return g.type="file",g.accept=".gpx,.kml,.geojson",g.style.display="none",g.addEventListener("change",function(){a.load(this.files[0])},!1),h.innerHTML=b.Control.FileLayerLoad.LABEL,h.href="#",h.title=b.Control.FileLayerLoad.TITLE,b.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",b.DomEvent.preventDefault).on(h,"click",function(a){g.click(),a.preventDefault()}),f}}),b.Control.fileLayerLoad=function(a){return new b.Control.FileLayerLoad(a)},c});